{"version":3,"file":"vue.js","sources":["../src/observe/arr.js","../src/observe/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["// 获取原来的数组方法\r\nlet oldArrayProtoMethods = Array.prototype\r\n// 继承 创建新的方法对象\r\nexport let arrMethods = Object.create(oldArrayProtoMethods)\r\n\r\nlet methods = ['push','pop',\"unshift\",\"shift\",\"splice\"]\r\n\r\nmethods.forEach(item=>{\r\n    arrMethods[item] = function(...args){\r\n        console.log('劫持数组');\r\n       let result =  oldArrayProtoMethods[item].apply(this,args)//this当前实例对象，\r\n        //observe中把类整体赋值给了__ob__可供在此调用数据劫持方法obseveArray\r\n\r\n        //args :push时为添加的数组参数\r\n        // 追加的数组对象进行数据劫持 push unshift  splice(第三个参数时新增的)\r\n        let inserted;\r\n        switch(item){\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args\r\n                break;\r\n            case 'splice':\r\n                inserted = args.splice(2)//arr.splice(0,1,{a:6})\r\n                break\r\n        }\r\n\r\n        // console.log(this,'this');//当前调用的数组对象\r\n        let ob = this.__ob__\r\n        if(inserted){\r\n            //对添加的对象进行劫持\r\n            ob.observeArray(inserted)\r\n        }\r\n        console.log(inserted,111);\r\n    \r\n       return result\r\n    }\r\n})","import { arrMethods } from \"./arr\"\r\n\r\nexport function observer(data){\r\n\r\n    if(typeof data != 'object' || data == null){\r\n        return data\r\n    }\r\n\r\n    return new Observer(data)\r\n\r\n}\r\n\r\nclass Observer{\r\n    constructor(data){\r\n        // 定义一个属性\r\n        Object.defineProperty(data,'__ob__',{\r\n            enumerable:false,\r\n            value:this,//this当前实例 this.observeArray\r\n        })\r\n\r\n        if(Array.isArray(data)){\r\n            // 对数组的方法进行劫持行操作\r\n            data.__proto__ = arrMethods\r\n            // 如果是对象数组，对数组对象劫持\r\n            this.observeArray(data)\r\n        }else{\r\n            this.walk(data) \r\n        }\r\n    }\r\n    // 遍历对象的属性，响应式劫持\r\n    walk(data){\r\n        let keys = Object.keys(data)\r\n        for(let i =0;i<keys.length;i++){\r\n            let key = keys[i]\r\n            let value = data[key]\r\n            defineReactive(data,key,value)\r\n        }\r\n    }\r\n    // 遍历对象数组\r\n    observeArray(value){\r\n        value.forEach(data=>{\r\n            observer(data)\r\n        })\r\n    }\r\n\r\n}\r\nfunction defineReactive(data,key,value){\r\n    observer(value)\r\n    Object.defineProperty(data,key,{\r\n        get(){\r\n            console.log('获取pbj');\r\n            return value\r\n        },\r\n        set(newValue){\r\n            console.log('设置obj');\r\n            if(newValue==value){\r\n                return\r\n            }\r\n            observer(newValue)\r\n            value = newValue\r\n        }\r\n    })\r\n}\r\n","import { observer } from \"./observe/index\"\r\n\r\n\r\nexport function initState(vm){\r\n    let ops = vm.$options\r\n    if(ops.props){\r\n        initProps(vm)\r\n    }   \r\n    if(ops.data){\r\n        initData(vm)\r\n    }\r\n    if(ops.watch){\r\n        initWatch(vm)\r\n    }\r\n    if(ops.methods){\r\n        initMethods(vm)\r\n    }\r\n    if(ops.computed){\r\n        initComputed(vm)\r\n    }\r\n}\r\n// 初始化data\r\nfunction initData(vm){\r\n    let data = vm.$options.data\r\n    // data()  this默认window \r\n    data = vm._data = typeof data == 'function'?data.call(vm):data \r\n\r\n    //将对象上的所有属性，代理到实例上{a:1,b:@}  defineProperty\r\n    for(let key  in data){\r\n        Proxy(vm,'_data',key)    \r\n    }\r\n\r\n    observer(data)\r\n}\r\nfunction Proxy(vm,source,key){\r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[source][key]\r\n        },\r\n        set(val){\r\n            vm[source][key] = val\r\n        }\r\n    })\r\n}\r\nfunction initProps(){}\r\nfunction initWatch(){}\r\nfunction initMethods(){}\r\nfunction initComputed(){}","import { initState } from \"./initState\";\r\nexport function initMixin(Vue){\r\n\r\n    Vue.prototype._init = function(options){\r\n        let vm = this\r\n        vm.$options = options\r\n        // init 状态\r\n        initState(vm)\r\n    }\r\n}","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options){\r\n     this._init(options)\r\n    \r\n\r\n\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","arrMethods","Object","create","methods","forEach","item","console","log","args","result","apply","inserted","splice","ob","__ob__","observeArray","observer","data","Observer","defineProperty","enumerable","value","isArray","__proto__","walk","keys","i","length","key","defineReactive","get","set","newValue","initState","vm","ops","$options","props","initData","watch","computed","_data","call","Proxy","source","val","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACA,IAAIA,oBAAoB,GAAGC,KAAK,CAACC,SAAjC;;EAEO,IAAIC,UAAU,GAAGC,MAAM,CAACC,MAAP,CAAcL,oBAAd,CAAjB,CAAA;EAEP,IAAIM,OAAO,GAAG,CAAC,MAAD,EAAQ,KAAR,EAAc,SAAd,EAAwB,OAAxB,EAAgC,QAAhC,CAAd,CAAA;EAEAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,IAAI,EAAE;EAClBL,EAAAA,UAAU,CAACK,IAAD,CAAV,GAAmB,YAAiB;MAChCC,OAAO,CAACC,GAAR,CAAY,MAAZ,CAAA,CAAA;;EADgC,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAALC,IAAK,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;QAALA,IAAK,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAAA,KAAA;;EAEjC,IAAA,IAAIC,MAAM,GAAIZ,oBAAoB,CAACQ,IAAD,CAApB,CAA2BK,KAA3B,CAAiC,IAAjC,EAAsCF,IAAtC,CAAd,CAFiC;EAGhC;EAEA;EACA;;EACA,IAAA,IAAIG,QAAJ,CAAA;;EACA,IAAA,QAAON,IAAP;EACI,MAAA,KAAK,MAAL,CAAA;EACA,MAAA,KAAK,SAAL;EACIM,QAAAA,QAAQ,GAAGH,IAAX,CAAA;EACA,QAAA,MAAA;;EACJ,MAAA,KAAK,QAAL;UACIG,QAAQ,GAAGH,IAAI,CAACI,MAAL,CAAY,CAAZ,CAAX,CADJ;;EAEI,QAAA,MAAA;EAPR,KARgC;;;MAmBhC,IAAIC,EAAE,GAAG,IAAA,CAAKC,MAAd,CAAA;;EACA,IAAA,IAAGH,QAAH,EAAY;EACR;QACAE,EAAE,CAACE,YAAH,CAAgBJ,QAAhB,CAAA,CAAA;EACH,KAAA;;EACDL,IAAAA,OAAO,CAACC,GAAR,CAAYI,QAAZ,EAAqB,GAArB,CAAA,CAAA;EAED,IAAA,OAAOF,MAAP,CAAA;KA1BH,CAAA;EA4BH,CA7BD,CAAA;;ECLO,SAASO,QAAT,CAAkBC,IAAlB,EAAuB;IAE1B,IAAG,OAAA,CAAOA,IAAP,CAAe,IAAA,QAAf,IAA2BA,IAAI,IAAI,IAAtC,EAA2C;EACvC,IAAA,OAAOA,IAAP,CAAA;EACH,GAAA;;EAED,EAAA,OAAO,IAAIC,QAAJ,CAAaD,IAAb,CAAP,CAAA;EAEH,CAAA;;MAEKC;EACF,EAAA,SAAA,QAAA,CAAYD,IAAZ,EAAiB;EAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,CAAA,CAAA;;EACb;EACAhB,IAAAA,MAAM,CAACkB,cAAP,CAAsBF,IAAtB,EAA2B,QAA3B,EAAoC;EAChCG,MAAAA,UAAU,EAAC,KADqB;QAEhCC,KAAK,EAAC,IAF0B;;OAApC,CAAA,CAAA;;EAKA,IAAA,IAAGvB,KAAK,CAACwB,OAAN,CAAcL,IAAd,CAAH,EAAuB;EACnB;EACAA,MAAAA,IAAI,CAACM,SAAL,GAAiBvB,UAAjB,CAFmB;;QAInB,IAAKe,CAAAA,YAAL,CAAkBE,IAAlB,CAAA,CAAA;EACH,KALD,MAKK;QACD,IAAKO,CAAAA,IAAL,CAAUP,IAAV,CAAA,CAAA;EACH,KAAA;EACJ;;;;;EAED,IAAA,KAAA,EAAA,SAAA,IAAA,CAAKA,IAAL,EAAU;EACN,MAAA,IAAIQ,IAAI,GAAGxB,MAAM,CAACwB,IAAP,CAAYR,IAAZ,CAAX,CAAA;;EACA,MAAA,KAAI,IAAIS,CAAC,GAAE,CAAX,EAAaA,CAAC,GAACD,IAAI,CAACE,MAApB,EAA2BD,CAAC,EAA5B,EAA+B;EAC3B,QAAA,IAAIE,GAAG,GAAGH,IAAI,CAACC,CAAD,CAAd,CAAA;EACA,QAAA,IAAIL,KAAK,GAAGJ,IAAI,CAACW,GAAD,CAAhB,CAAA;EACAC,QAAAA,cAAc,CAACZ,IAAD,EAAMW,GAAN,EAAUP,KAAV,CAAd,CAAA;EACH,OAAA;EACJ;;;;EAED,IAAA,KAAA,EAAA,SAAA,YAAA,CAAaA,KAAb,EAAmB;EACfA,MAAAA,KAAK,CAACjB,OAAN,CAAc,UAAAa,IAAI,EAAE;UAChBD,QAAQ,CAACC,IAAD,CAAR,CAAA;SADJ,CAAA,CAAA;EAGH,KAAA;;;;;;EAGL,SAASY,cAAT,CAAwBZ,IAAxB,EAA6BW,GAA7B,EAAiCP,KAAjC,EAAuC;IACnCL,QAAQ,CAACK,KAAD,CAAR,CAAA;EACApB,EAAAA,MAAM,CAACkB,cAAP,CAAsBF,IAAtB,EAA2BW,GAA3B,EAA+B;EAC3BE,IAAAA,GAD2B,EACtB,SAAA,GAAA,GAAA;QACDxB,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAA,CAAA;EACA,MAAA,OAAOc,KAAP,CAAA;OAHuB;MAK3BU,GAL2B,EAAA,SAAA,GAAA,CAKvBC,QALuB,EAKd;QACT1B,OAAO,CAACC,GAAR,CAAY,OAAZ,CAAA,CAAA;;QACA,IAAGyB,QAAQ,IAAEX,KAAb,EAAmB;EACf,QAAA,OAAA;EACH,OAAA;;QACDL,QAAQ,CAACgB,QAAD,CAAR,CAAA;EACAX,MAAAA,KAAK,GAAGW,QAAR,CAAA;EACH,KAAA;KAZL,CAAA,CAAA;EAcH;;EC3DM,SAASC,SAAT,CAAmBC,EAAnB,EAAsB;EACzB,EAAA,IAAIC,GAAG,GAAGD,EAAE,CAACE,QAAb,CAAA;;IACA,IAAGD,GAAG,CAACE,KAAP,EAAa,CAEZ;;IACD,IAAGF,GAAG,CAAClB,IAAP,EAAY;MACRqB,QAAQ,CAACJ,EAAD,CAAR,CAAA;EACH,GAAA;;IACD,IAAGC,GAAG,CAACI,KAAP,EAAa,CAEZ;;IACD,IAAGJ,GAAG,CAAChC,OAAP,EAAe,CAEd;;IACD,IAAGgC,GAAG,CAACK,QAAP,EAAgB,CAEf;EACJ;;EAED,SAASF,QAAT,CAAkBJ,EAAlB,EAAqB;IACjB,IAAIjB,IAAI,GAAGiB,EAAE,CAACE,QAAH,CAAYnB,IAAvB,CADiB;;EAGjBA,EAAAA,IAAI,GAAGiB,EAAE,CAACO,KAAH,GAAW,OAAOxB,IAAP,IAAe,UAAf,GAA0BA,IAAI,CAACyB,IAAL,CAAUR,EAAV,CAA1B,GAAwCjB,IAA1D,CAHiB;;EAMjB,EAAA,KAAI,IAAIW,GAAR,IAAgBX,IAAhB,EAAqB;EACjB0B,IAAAA,KAAK,CAACT,EAAD,EAAI,OAAJ,EAAYN,GAAZ,CAAL,CAAA;EACH,GAAA;;IAEDZ,QAAQ,CAACC,IAAD,CAAR,CAAA;EACH,CAAA;;EACD,SAAS0B,KAAT,CAAeT,EAAf,EAAkBU,MAAlB,EAAyBhB,GAAzB,EAA6B;EACzB3B,EAAAA,MAAM,CAACkB,cAAP,CAAsBe,EAAtB,EAAyBN,GAAzB,EAA6B;EACzBE,IAAAA,GADyB,EACpB,SAAA,GAAA,GAAA;EACD,MAAA,OAAOI,EAAE,CAACU,MAAD,CAAF,CAAWhB,GAAX,CAAP,CAAA;OAFqB;MAIzBG,GAJyB,EAAA,SAAA,GAAA,CAIrBc,GAJqB,EAIjB;EACJX,MAAAA,EAAE,CAACU,MAAD,CAAF,CAAWhB,GAAX,IAAkBiB,GAAlB,CAAA;EACH,KAAA;KANL,CAAA,CAAA;EAQH;;EC1CM,SAASC,SAAT,CAAmBC,GAAnB,EAAuB;EAE1BA,EAAAA,GAAG,CAAChD,SAAJ,CAAciD,KAAd,GAAsB,UAASC,OAAT,EAAiB;MACnC,IAAIf,EAAE,GAAG,IAAT,CAAA;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAca,OAAd,CAFmC;;MAInChB,SAAS,CAACC,EAAD,CAAT,CAAA;KAJJ,CAAA;EAMH;;ECPD,SAASa,GAAT,CAAaE,OAAb,EAAqB;IAChB,IAAKD,CAAAA,KAAL,CAAWC,OAAX,CAAA,CAAA;EAIJ,CAAA;;EAEDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}